{
	"jobConfig": {
		"name": "nyc-taxi-processed-curated",
		"description": "",
		"role": "arn:aws:iam::474668386387:role/service-role/AWSGlueServiceRole-nandni",
		"command": "glueetl",
		"version": "5.0",
		"runtime": null,
		"workerType": "G.1X",
		"numberOfWorkers": 10,
		"maxCapacity": 10,
		"jobRunQueuingEnabled": false,
		"maxRetries": 0,
		"timeout": 480,
		"maxConcurrentRuns": 1,
		"security": "none",
		"scriptName": "nyc-taxi-processed-curated.py",
		"scriptLocation": "s3://aws-glue-assets-474668386387-us-west-2/scripts/",
		"language": "python-3",
		"spark": true,
		"sparkConfiguration": "standard",
		"jobParameters": [],
		"tags": [],
		"jobMode": "DEVELOPER_MODE",
		"createdOn": "2026-01-15T02:02:44.791Z",
		"developerMode": true,
		"connectionsList": [],
		"temporaryDirectory": "s3://aws-glue-assets-474668386387-us-west-2/temporary/",
		"glueHiveMetastore": true,
		"etlAutoTuning": false,
		"metrics": true,
		"observabilityMetrics": true,
		"bookmark": "job-bookmark-disable",
		"sparkPath": "s3://aws-glue-assets-474668386387-us-west-2/sparkHistoryLogs/",
		"flexExecution": false,
		"minFlexWorkers": null,
		"maintenanceWindow": null
	},
	"hasBeenSaved": false,
	"usageProfileName": null,
	"script": "# =====================================================\n# Glue Job: nyc-taxi-processed-curated\n# Purpose : Processed â†’ Curated\n# =====================================================\n\nfrom awsglue.context import GlueContext\nfrom pyspark.context import SparkContext\nfrom pyspark.sql import functions as F\nfrom pyspark.sql.types import IntegerType, DoubleType, TimestampType\nimport boto3\n\n# -----------------------------------------------------\n# Spark / Glue setup\n# -----------------------------------------------------\nsc = SparkContext()\nglueContext = GlueContext(sc)\nspark = glueContext.spark_session\n\nspark.conf.set(\"spark.sql.sources.partitionOverwriteMode\", \"dynamic\")\n\n# -----------------------------------------------------\n# Paths\n# -----------------------------------------------------\nSRC_PATH = \"s3://my-data-lake-lab-nandnioubt/processed/nyc_taxi/\"\nTGT_PATH = \"s3://my-data-lake-lab-nandnioubt/curated/nyc_taxi/\"\n\n# -----------------------------------------------------\n# Read Processed Data\n# -----------------------------------------------------\nprint(\"Reading processed NYC taxi data...\")\ndf = spark.read.parquet(SRC_PATH)\n\nif df.rdd.isEmpty():\n    raise Exception(\"Processed dataset is empty\")\n\nprint(f\"Processed record count: {df.count()}\")\n\n# -----------------------------------------------------\n# Data Type Standardization\n# -----------------------------------------------------\ndf = (\n    df\n    .withColumn(\"vendorid\", F.col(\"vendorid\").cast(IntegerType()))\n    .withColumn(\"ratecodeid\", F.col(\"ratecodeid\").cast(IntegerType()))\n    .withColumn(\"passenger_count\", F.col(\"passenger_count\").cast(IntegerType()))\n    .withColumn(\"trip_distance\", F.col(\"trip_distance\").cast(DoubleType()))\n    .withColumn(\"fare_amount\", F.col(\"fare_amount\").cast(DoubleType()))\n    .withColumn(\"tip_amount\", F.col(\"tip_amount\").cast(DoubleType()))\n    .withColumn(\"total_amount\", F.col(\"total_amount\").cast(DoubleType()))\n    .withColumn(\"tpep_pickup_datetime\", F.col(\"tpep_pickup_datetime\").cast(TimestampType()))\n    .withColumn(\"tpep_dropoff_datetime\", F.col(\"tpep_dropoff_datetime\").cast(TimestampType()))\n)\n\n# -----------------------------------------------------\n# Business Rule Filters\n# -----------------------------------------------------\ndf = df.filter(\n    (F.col(\"trip_distance\") > 0) &\n    (F.col(\"total_amount\") > 0) &\n    (F.col(\"tpep_dropoff_datetime\") > F.col(\"tpep_pickup_datetime\"))\n)\n\n# -----------------------------------------------------\n# # Enrich & derive metrics\n# -----------------------------------------------------\ndf = (\n    df\n    .withColumn(\n        \"trip_duration_minutes\",\n        (F.unix_timestamp(\"tpep_dropoff_datetime\") -\n         F.unix_timestamp(\"tpep_pickup_datetime\")) / 60\n    )\n    .withColumn(\"pickup_date\", F.to_date(\"tpep_pickup_datetime\"))\n    .withColumn(\"pickup_year\", F.year(\"tpep_pickup_datetime\"))\n    .withColumn(\"pickup_month\", F.month(\"tpep_pickup_datetime\"))\n)\n\n# -----------------------------------------------------\n# Audit Columns\n# -----------------------------------------------------\ndf = (\n    df\n    .withColumn(\"curated_ts\", F.current_timestamp())\n    .withColumn(\"record_source\", F.lit(\"nyc_taxi_processed\"))\n)\n\n# -----------------------------------------------------\n# Write Curated Data\n# -----------------------------------------------------\nprint(\"Writing curated NYC taxi data...\")\n\n(\n    df\n    .write\n    .mode(\"overwrite\")\n    #.partitionBy(\"pickup_year\", \"pickup_month\")\n    .parquet(TGT_PATH)\n)\n\nprint(\"nyc-taxi-processed-curated job completed successfully.\")\n\n# -----------------------------------------------------\n# # Initialize CloudWatch client\n# -----------------------------------------------------\ncloudwatch = boto3.client('cloudwatch')\n\n# Example results of governance checks\nrow_count_pass = 1 if df.count() > 0 else 0\nnull_check_pass = 1 if df.filter(\"VendorID IS NULL\").count() == 0 else 0\nduplicate_check_pass = 1 if df.count() == df.dropDuplicates([\"VendorID\"]).count() else 0\n\n# Emit custom metrics to CloudWatch\ncloudwatch.put_metric_data(\n    Namespace='GlueGovernance',\n    MetricData=[\n        {\n            'MetricName': 'RowCountCheck',\n            'Dimensions': [\n                {'Name': 'JobName', 'Value': 'nyc-taxi-processed-curated'}\n            ],\n            'Value': row_count_pass,\n            'Unit': 'Count'\n        },\n        {\n            'MetricName': 'NullCheck',\n            'Dimensions': [\n                {'Name': 'JobName', 'Value': 'nyc-taxi-processed-curated'}\n            ],\n            'Value': null_check_pass,\n            'Unit': 'Count'\n        },\n        {\n            'MetricName': 'DuplicateCheck',\n            'Dimensions': [\n                {'Name': 'JobName', 'Value': 'nyc-taxi-processed-curated'}\n            ],\n            'Value': duplicate_check_pass,\n            'Unit': 'Count'\n        }\n    ]\n)\n"
}