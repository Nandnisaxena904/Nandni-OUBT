{
	"jobConfig": {
		"name": "nyc-taxi-raw-ingest",
		"description": "",
		"role": "arn:aws:iam::474668386387:role/service-role/AWSGlueServiceRole-nandni",
		"command": "glueetl",
		"version": "5.0",
		"runtime": null,
		"workerType": "G.1X",
		"numberOfWorkers": 10,
		"maxCapacity": 10,
		"jobRunQueuingEnabled": false,
		"maxRetries": 0,
		"timeout": 480,
		"maxConcurrentRuns": 3,
		"security": "none",
		"scriptName": "nyc-taxi-raw-ingest.py",
		"scriptLocation": "s3://aws-glue-assets-474668386387-us-west-2/scripts/",
		"language": "python-3",
		"spark": true,
		"sparkConfiguration": "standard",
		"jobParameters": [],
		"tags": [],
		"jobMode": "DEVELOPER_MODE",
		"createdOn": "2026-01-15T01:20:55.633Z",
		"developerMode": true,
		"connectionsList": [],
		"temporaryDirectory": "s3://aws-glue-assets-474668386387-us-west-2/temporary/",
		"glueHiveMetastore": true,
		"etlAutoTuning": true,
		"metrics": true,
		"observabilityMetrics": true,
		"bookmark": "job-bookmark-disable",
		"sparkPath": "s3://aws-glue-assets-474668386387-us-west-2/sparkHistoryLogs/",
		"flexExecution": false,
		"minFlexWorkers": null,
		"maintenanceWindow": null
	},
	"hasBeenSaved": false,
	"usageProfileName": null,
	"script": "# =====================================================\n# Glue Job: nyc-taxi-raw-ingest\n# Purpose : Raw â†’ Processed ingestion\n# =====================================================\n\nfrom awsglue.context import GlueContext\nfrom awsglue.utils import getResolvedOptions\nfrom pyspark.context import SparkContext\nfrom pyspark.sql import functions as F\nimport boto3\nimport sys\n\n# -----------------------------------------------------\n# Glue / Spark setup\n# -----------------------------------------------------\nsc = SparkContext()\nglueContext = GlueContext(sc)\nspark = glueContext.spark_session\n\nspark.conf.set(\"spark.sql.sources.partitionOverwriteMode\", \"dynamic\")\n\n# -----------------------------------------------------\n# Config\n# -----------------------------------------------------\nRAW_PATH = \"s3://my-data-lake-lab-nandnioubt/raw/nyc_taxi/\"\nPROCESSED_PATH = \"s3://my-data-lake-lab-nandnioubt/processed/nyc_taxi/\"\n\n# -----------------------------------------------------\n# Read Raw Data\n# -----------------------------------------------------\nprint(\"Reading raw NYC taxi data...\")\nraw_df = spark.read.parquet(RAW_PATH)\n\n# -----------------------------------------------------\n# Basic Data Validation\n# -----------------------------------------------------\nif raw_df.rdd.isEmpty():\n    raise Exception(\"Raw dataset is empty. Aborting job.\")\n\nprint(f\"Raw record count: {raw_df.count()}\")\n\n# -----------------------------------------------------\n# Transformations (minimal, ingestion layer)\n# -----------------------------------------------------\nprocessed_df = (\n    raw_df\n    .withColumn(\"ingestion_timestamp\", F.current_timestamp())\n    .withColumn(\"source_system\", F.lit(\"nyc_taxi\"))\n    .withColumn(\"file_month\", F.date_format(\"tpep_pickup_datetime\", \"yyyy-MM\"))\n)\n\n# -----------------------------------------------------\n# Write to Processed Zone\n# -----------------------------------------------------\nprint(\"Writing data to processed zone...\")\n\n(\n    processed_df\n    .write\n    .mode(\"overwrite\")\n    #.partitionBy(\"file_month\")\n    .parquet(PROCESSED_PATH)\n)\n\nprint(\"nyc-taxi-raw-ingest job completed successfully.\")\n\n# -----------------------------------------------------\n# # Initialize CloudWatch client\n# -----------------------------------------------------\ncloudwatch = boto3.client('cloudwatch')\n\n# Example results of governance checks\nrow_count_pass = 1 if processed_df.count() > 0 else 0\nnull_check_pass = 1 if processed_df.filter(\"VendorID IS NULL\").count() == 0 else 0\nduplicate_check_pass = 1 if processed_df.count() == processed_df.dropDuplicates([\"VendorID\"]).count() else 0\n\n# Emit custom metrics to CloudWatch\ncloudwatch.put_metric_data(\n    Namespace='GlueGovernance',\n    MetricData=[\n        {\n            'MetricName': 'RowCountCheck',\n            'Dimensions': [\n                {'Name': 'JobName', 'Value': 'nyc-taxi-raw-ingest'}\n            ],\n            'Value': row_count_pass,\n            'Unit': 'Count'\n        },\n        {\n            'MetricName': 'NullCheck',\n            'Dimensions': [\n                {'Name': 'JobName', 'Value': 'nyc-taxi-raw-ingest'}\n            ],\n            'Value': null_check_pass,\n            'Unit': 'Count'\n        },\n        {\n            'MetricName': 'DuplicateCheck',\n            'Dimensions': [\n                {'Name': 'JobName', 'Value': 'nyc-taxi-raw-ingest'}\n            ],\n            'Value': duplicate_check_pass,\n            'Unit': 'Count'\n        }\n    ]\n)\n"
}